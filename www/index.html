<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport"
              content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="apple-touch-icon" sizes="57x57" href="assets/img/favicons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="assets/img/favicons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="assets/img/favicons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="assets/img/favicons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="assets/img/favicons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="assets/img/favicons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="assets/img/favicons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="assets/img/favicons/apple-touch-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="assets/img/favicons/apple-touch-icon-180x180.png">
        <link rel="icon" type="image/png" href="assets/img/favicons/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="assets/img/favicons/android-chrome-192x192.png" sizes="192x192">
        <link rel="icon" type="image/png" href="assets/img/favicons/favicon-96x96.png" sizes="96x96">
        <link rel="icon" type="image/png" href="assets/img/favicons/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="assets/img/favicons/manifest.json">
        <!--
        <meta name="msapplication-TileColor" content="#2b5797">
        <meta name="msapplication-TileImage" content="assets/img/favicons/mstile-144x144.png">
        <meta name="theme-color" content="#ffffff">
    -->
        <title>NOX</title>

        <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css" type="text/css">
        <link rel="stylesheet" href="bower_components/framework7/dist/css/framework7.ios.min.css" type="text/css">
        <link rel="stylesheet" href="bower_components/swipebox/src/css/swipebox.css" type="text/css">
        <link rel="stylesheet" href="bower_components/owl-carousel/owl-carousel/owl.carousel.css" type="text/css">
        <link rel="stylesheet" href="bower_components/owl-carousel/owl-carousel/owl.theme.css" type="text/css">

        <link rel="stylesheet" href="assets/css/app.css" type="text/css">
        <!--<link rel="stylesheet" href="assets/themes//style.css" id="theme-style">-->

        <style>
            .list-block {
                margin: 5px 0;
            }

            /* CSS CHECKOUT ------------------------------------------------- */
            #tabbar-checkout div[class*="col-"] {
                text-align: center;
                color: #FFF;
                padding: 5px 0px;
                font-size: 11px;
            }
            #tabbar-checkout div[class*="col-"] strong {
                font-size: 22px;
                 display:block; 
                 clear:both
            }
            
            /* CSS FILTRO --------------------------------------------------- */
            #page-filter .swiper-wrapper {
                margin: 5px;
            }
            #page-filter .swiper-slide {
                color:#000;
                background: #FFF;
                box-sizing: border-box;
                border: 1px solid #ccc;
            }
            #page-filter .swiper-slide label {
                text-align:center;
                display:block;
                padding-top: 20px;
                padding-bottom: 100%;
                font-size:16px;
            }
            #page-filter .swiper-slide label div {
                text-align:center;
                width: 100%;
            }
            #page-filter .swiper-slide label div.item-inner {
                padding-top: 35px;
            }
            #page-filter .swiper-container {
                height: 120px;
                margin: 5px;
            }
            #page-filter .swiper-slide label.label-radio input[type=radio]:checked~.item-inner {
                background-size: 32px;
                background-position: center top;
            }
            #page-filter .swiper-slide label.label-radio input[type=radio]~.item-inner {
                padding-right: 0px;
            }
            
            
        </style>

    </head>
    <body class="">

        <div class="statusbar-overlay"></div>
        <div class="panel-overlay"></div>

        <!-- Left panel -->
        <div class="panel panel-left panel-reveal">
            <div class="line"></div>

            <div class="logo-box mt-10">
                <strong>Saldo Atual</strong>
                <div>R$ 0,00</div>
            </div>

            <div class="list-block mt-15">
                <div class="list-group">
                    <nav>
                        <ul>
                            <li class="divider">
                                Menu
                            </li>
                            <!--
                            <li>
                                <a href="profile.html" class="item-link close-panel item-content">
                                    <div class="item-media">
                                        <i class="fa fa-user"></i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">Perfil</div>
                                    </div>
                                </a>
                            </li>
                            -->
                            <li>
                                <a href="main.html" class="item-link close-panel item-content">
                                    <div class="item-media">
                                        <i class="fa fa-tags"></i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">Promoções</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="establishment.html" class="item-link close-panel item-content">
                                    <div class="item-media">
                                        <i class="fa fa-home"></i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">Estabelecimentos</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="shopping.html" class="item-link close-panel item-content">
                                    <div class="item-media">
                                        <i class="fa fa-check"></i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">Compras realizadas</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="cash-out.html" class="item-link close-panel item-content">
                                    <div class="item-media">
                                        <i class="fa fa-money"></i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">Solicitar saque</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="invite-friend.html" class="item-link close-panel item-content">
                                    <div class="item-media">
                                        <i class="fa fa-users"></i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">Convidar amigos</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="filter.html" class="item-link close-panel item-content">
                                    <div class="item-media">
                                        <i class="fa fa-filter"></i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">Filtrar</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="change-password.html" class="item-link close-panel item-content">
                                    <div class="item-media">
                                        <i class="fa fa-key"></i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">Alterar senha</div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="item-link close-panel item-content" onclick="logout()">
                                    <div class="item-media">
                                        <i class="fa fa-close"></i>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">Sair</div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

        </div>

        <!-- Right panel -->
        <div class="panel panel-right panel-reveal"></div>

        <!-- Views -->
        <div class="views">
            <div class="view view-main">
                <div class="navbar"></div>
                <div class="pages navbar-fixed toolbar-fixed "></div>
            </div>
        </div>

        <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
        <script type="text/javascript" src="bower_components/swipebox/src/js/jquery.swipebox.min.js"></script>
        <script type="text/javascript" src="bower_components/framework7/dist/js/framework7.min.js"></script>
        <script type="text/javascript" src="bower_components/jquery-validation/dist/jquery.validate.min.js"></script>
        <script type="text/javascript" src="bower_components/Tweetie/tweetie.min.js"></script>
        <script type="text/javascript" src="bower_components/chartjs/Chart.js"></script>
        <script type="text/javascript" src="bower_components/scrollAnimate/jquery.scrollAnimate.js"></script>
        <script src="bower_components/owl-carousel/owl-carousel/owl.carousel.min.js"></script>

        <script type="text/javascript" src="assets/js/jflickrfeed.min.js"></script>
        <script type="text/javascript" src="assets/js/min/app.js"></script>
        <script type="text/javascript" src="assets/js/animations.js"></script>

        <!-- Complementares -->
        <script type="text/javascript" src="assets/js/jquery-block/jquery.blockUI.js"></script>
        <script type="text/javascript" src="assets/js/masked-input/jquery.maskedinput.min.js"></script>
        <script type="text/javascript" src="assets/js/masked-input/jquery.maskMoney.min.js"></script>
        <script type="text/javascript" src="assets/js/appExt.js"></script>
        <script type="text/javascript" src="assets/js/global.js"></script>

        <script>

            // mascara de CPF
            // $("input[name='cpf_cnpj']").mask("999.999.999-99").attr('placeholder', 'CPF');
            
            
            // -----------------------------------------------------------------
            // index carrega a pagina principal de promocoes ou tela de login
            (validateLogin()) ? mainView.router.loadPage('main.html') : mainView.router.loadPage('login.html');


            // -----------------------------------------------------------------
            // login
            myApp.onPageInit('login', function (page) {
                $$('#login-button').on('click', function () {
                    validateLogin(myApp.formToJSON('#login-form'));
                });
            });
            
            
            // -----------------------------------------------------------------
            // registration
            myApp.onPageInit('registration', function (page) {

                // envia form de cadastro de usuario
                $$('#loginCreate-button').on('click', function () {
                    ajaxApi('login-create', myApp.formToJSON('#loginCreate-form'), callbackLoginCreate);
                });

                // callback login create
                var callbackLoginCreate = function(a) {
                    myApp.alert('','Usuário cadastrado!');
                    mainView.router.loadPage('index.html');
                };
            });
            

            // -----------------------------------------------------------------
            // promocoes
            securePage('main', function (page) {
                
                templateMain = new Template('templateMain');
                $.extend(page.query, {user_auth_key: getUserData().auth_key});
                templateMain.compileAjax('promocao', page.query, function (a) {
                    if (!a.estabelecimentos.length) {
                        myApp.alert('Nenhum estabelecimento encontrado para o filtro selecionado...', 'Opss', function(){ 
                            mainView.router.loadPage('filter.html'); 
                        });
                    }
                });
            });
            
            
            // -----------------------------------------------------------------
            // pesquisa
            securePage('search', function (page) {
                var templateSearch = new Template('templateSearch');

                // realiza pesquisa
                $$('#btn-pesquisa').on('click', function () {
                    var dataPesquisa = $('input#campo-pesquisa').val();
                    if (dataPesquisa) {
                        ajaxApi('search', {param: dataPesquisa}, callbackSearch);
                    }
                });

                // callback da pesquisa
                var callbackSearch = function(a) {
                    templateSearch.compileAndLoadData(a);
                };

            });


            // -----------------------------------------------------------------
            // filtro
            securePage('filter', function (page) {
                var templateFilter = new Template('templateFilter');

                // busca categorias
                ajaxApi('filter-category', {}, function(a) {
                    templateFilter.compileAndLoadData(a);
                    
                    // slides
                    myApp.swiper('.swiper-4', {
                      //pagination:'.swiper-4 .swiper-pagination',
                      spaceBetween: 20,
                      slidesPerView: 4
                    });
                });

            });


            // -----------------------------------------------------------------
            // convidar amigo
            securePage('invite-friend', function (page) {
                var templateInviteFriend = new Template('templateInviteFriend');
                templateInviteFriend.compileAjax('invite-friend', {user_auth_key: getUserData().auth_key});
                
            });


            // -----------------------------------------------------------------
            // solicitar saque
            securePage('cash-out', function (page) {
                var templateCashOut = new Template('templateCashOut');
                var callbackCashOut = function (a) {
                    
                    // form de solicitacao de saque
                    var formCashOut = new Form('cashOut-form');
                    
                    // add opcoes de banco
                    formCashOut.addOptionsSelect("CB03_COD_BANCO", a.bancos);
                    
                    // add opcoes de tipo de conta
                    formCashOut.addOptionsSelect("CB03_TP_CONTA", a.tp_conta);
                    
                    // add mascara de moeda (REAL)
                    formCashOut.setMoney(["CB03_VALOR"]);
                    
                    // set attributes
                    if (typeof a.conta_bancaria != "undefined") {
                        formCashOut.setFormData(a.conta_bancaria);
                    }
                    
                    $('a#cashOut-submit').on('click', function () {
                        ajaxCashOut(formCashOut.getFormData());
                    });
                };

                // busca dados da tela de solicitacao de saque
                ajaxCashOut = function (param) { 
                    var param = (param || {});
                    templateCashOut.compileAjax('cash-out', $.extend(param, {user_auth_key: getUserData().auth_key}), callbackCashOut);
                };
                
                ajaxCashOut();
                
            });


            // -----------------------------------------------------------------
            // minhas compras
            securePage('shopping', function (page) {
                var templateShopping = new Template('templateShopping');
                templateShopping.compileAjax('shopping', {user_auth_key: getUserData().auth_key});
            });


            // -----------------------------------------------------------------
            // estabelecimento
            securePage('establishment', function (page) {
                var templateEstablishment = new Template('templateEstablishment');
                templateEstablishment.compileAjax('establishment', {});
            });


            // -----------------------------------------------------------------
            // perfil
            securePage('profile', function (page) {
                var templateProfile = new Template('templateProfile');
                templateProfile.compileAjax('profile', {user_auth_key: getUserData().auth_key});
            });


            // -----------------------------------------------------------------
            // alterar senha
            securePage('change-password', function (page) {
                var templateProfile = new Template('templateChangePassword');
                templateProfile.compileAndLoadData();

                // form - alterar senha
                var formChangePassword = new Form('changePassword-form');
                
                // salvar
                $('a#changePassword-submit').on('click', function () {
                    ajaxApiUser('change-password', formChangePassword.getFormData(), function(a){
                        if(typeof a.message != 'undefined') {
                            formChangePassword.clear();
                            myApp.alert('',a.message);
                        }
                    });
                });
                
            });


            // -----------------------------------------------------------------
            // checkout
            securePage('checkout', function (page) {
                var templateProfile = new Template('templateCheckout'),
                param = page.query;
                param.user_auth_key = getUserData().auth_key;
                templateProfile.compileAjax('checkout', param, function (a) {
                    if(a === false) {
                        mainView.router.loadPage('main.html'); 
                        
                    } else {
                        // form - checkout
                        var formCheckout = new Form('checkout-form');

                        // salvar
                        $('a#checkout-submit').on('click', function () {
                            console.log(formCheckout.getFormData());
                            //ajaxApiUser('checkout', formCheckout.getFormData(), function(a){});
                        });
                    }
                });
                
            });

            
        </script>

    </body>
</html>


